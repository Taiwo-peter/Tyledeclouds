# Use Alpine as the base image
FROM alpine:3.18

# Install MariaDB and dependencies
RUN apk --no-cache add mariadb mariadb-client bash

# Create required directories with secure permissions
RUN mkdir -p /var/lib/mysql /run/mysqld && \
    chown -R mysql:mysql /var/lib/mysql /run/mysqld && \
    chmod 755 /run/mysqld  # Secure directory permissions

# Copy entrypoint script
COPY entrypoint.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/entrypoint.sh

# Expose MySQL port
EXPOSE 3306

# Set entrypoint script
ENTRYPOINT ["/usr/local/bin/entrypoint.sh"]